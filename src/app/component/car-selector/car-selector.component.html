<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div class="car-selector-container-top">
        <div class="form-inline">
          <div class="form-group">
            <label for="make">Make</label>
            <ng-select
              [items]="makes"
              [(ngModel)]="selectedMake"
              (change)="onMakeSelectionChange()"
              bindLabel="make"
              [searchable]="false"
              [clearable]="false"
              ngDefaultControl
            >
              <ng-option *ngFor="let make of makes" [value]="make">{{
                make
              }}</ng-option>
            </ng-select>
          </div>
          <div class="form-group">
            <label for="model">Model</label>
            <ng-select
              id="model"
              [(ngModel)]="selectedModel"
              (change)="onModelSelectionChange()"
              [disabled]="!selectedMake"
              [searchable]="false"
              [clearable]="false"
            >
              <ng-option *ngFor="let model of models" [value]="model">{{
                model
              }}</ng-option>
            </ng-select>
          </div>
          <div class="form-group">
            <label for="year">Year</label>
            <ng-select
              id="year"
              [(ngModel)]="selectedYear"
              (change)="onYearSelectionChange()"
              [disabled]="!selectedModel"
              [multiple]="true"
              placeholder="Select Year"
            >
              <ng-option *ngFor="let year of years" [value]="year">{{
                year
              }}</ng-option>
            </ng-select>
          </div>
        </div>
      </div>

      <div class="car-selector-container" *ngIf="trimEngines.length">
        <h2>Select Vehicles</h2>
        <div class="form-group mb-3 mx-4">
          <input
            type="checkbox"
            id="select-all-checkbox"
            name="select-all"
            [checked]="selectedTrims.length != trims.length"
            (change)="selectAllTrims($event)"
          />
          <label for="select-all-checkbox"> <strong> Select All</strong></label>
        </div>

        <div class="row justify-content-end">
          <div class="col-md-11">
            <div *ngFor="let trim of trimEngines; let i = index">
              <div class="dropdown-container-width">
                <input
                  type="checkbox"
                  id="{{ i }}"
                  name="{{ trim.make }}"
                  [checked]="isMakeModelYearSelected(trim, i)"
                  (change)="selectMakeModelYear(trim, $event)"
                />
                <label for="test"
                  ><strong
                    >{{ trim.make }} {{ trim.model }} {{ trim.year }}</strong
                  ></label
                >
              </div>

              <div class="car-list-container">
                <table>
                  <thead>
                    <tr>
                      <th></th>
                      <th>Trim</th>
                      <th>Engine</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let trimValue of trim.value">
                      <td>
                        <input
                          type="checkbox"
                          name="trim"
                          [checked]="isTrimSelected(trimValue.id)"
                          (change)="toggleTrimSelection(trimValue.id)"
                        />
                      </td>
                      <td>{{ trimValue.trim }}</td>
                      <td>{{ trimValue.engine }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-12 offset-5" *ngIf="trimEngines.length">
        <button
          type="button"
          (click)="showModal()"
          class="btn btn-primary text-center"
          data-toggle="modal"
          data-target="#exampleModal"
        >
          Preview
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal"
  *ngIf="showPopup"
  class="modal"
  id="exampleModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Preview Table</h4>
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Make</th>
              <th>Model</th>
              <th>Year</th>
              <th>Trim</th>
              <th>Engine</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of popupData">
              <td>{{ data.make }}</td>
              <td>{{ data.model }}</td>
              <td>{{ data.year }}</td>
              <td>{{ data.trim }}</td>
              <td>{{ data.engine }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
